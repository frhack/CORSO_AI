<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Derivative</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
    background: #0a0a0a;
    color: #e0e0e0;
}

.bottom {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 16px 0 22px;
    background: #0a0a0a;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
    z-index: 10;
}

.values {
    display: flex;
    gap: 50px;
    font-size: 1.05rem;
}
.values .item { text-align: center; }
.values .label {
    color: #666;
    font-size: 0.75rem;
    margin-bottom: 4px;
}
.values .num {
    font-size: 1.3rem;
    font-weight: 600;
}
.values .num.x-val { color: #e0e0e0; }
.values .num.fx-val { color: #5e9cff; }
.values .num.dfx-val { color: #f0c040; }

.slider-wrap { width: 100%; }
input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 4px;
    background: #333;
    border-radius: 2px;
    outline: none;
}
input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    background: #f0c040;
    border-radius: 50%;
    cursor: pointer;
}
input[type="range"]::-moz-range-thumb {
    width: 18px;
    height: 18px;
    background: #f0c040;
    border-radius: 50%;
    cursor: pointer;
    border: none;
}
</style>
</head>
<body>

<canvas id="graph"></canvas>

<div class="bottom">
    <div class="values">
        <div class="item">
            <div class="label">x</div>
            <div class="num x-val" id="v-x">0.00</div>
        </div>
        <div class="item">
            <div class="label">f(x)</div>
            <div class="num fx-val" id="v-fx">0.00</div>
        </div>
        <div class="item">
            <div class="label">f'(x)</div>
            <div class="num dfx-val" id="v-dfx">0.00</div>
        </div>
    </div>
    <div class="slider-wrap">
        <input type="range" id="slider" min="-3" max="3" step="0.01" value="1">
    </div>
</div>

<script>
const canvas = document.getElementById('graph');
const ctx = canvas.getContext('2d');
const bottomH = 100; // reserved for controls

function resize() {
    const dpr = window.devicePixelRatio || 1;
    const w = window.innerWidth;
    const h = window.innerHeight - bottomH;
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
    canvas.width = w * dpr;
    canvas.height = h * dpr;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}

let W, H;
// y range is fixed; x range adapts to aspect ratio so scale is uniform
const yMin = -1.5, yMax = 10.5;
let xMin, xMax;

function updateRanges() {
    const yRange = yMax - yMin;          // 12 units
    const scale = H / yRange;            // pixels per unit (from y)
    const xRange = W / scale;            // how many units fit horizontally
    const xCenter = 0;
    xMin = xCenter - xRange / 2;
    xMax = xCenter + xRange / 2;
}

function toScreen(wx, wy) {
    return [
        (wx - xMin) / (xMax - xMin) * W,
        H - (wy - yMin) / (yMax - yMin) * H
    ];
}

function f(x) { return x * x; }
function df(x) { return 2 * x; }

function draw(xVal) {
    W = canvas.width / (window.devicePixelRatio || 1);
    H = canvas.height / (window.devicePixelRatio || 1);
    updateRanges();

    // Sync slider range with x axis
    slider.min = xMin.toFixed(1);
    slider.max = xMax.toFixed(1);

    ctx.clearRect(0, 0, W, H);

    // Grid
    ctx.strokeStyle = '#1a1a1a';
    ctx.lineWidth = 1;
    for (let gx = Math.ceil(xMin); gx <= xMax; gx++) {
        const [sx] = toScreen(gx, 0);
        ctx.beginPath(); ctx.moveTo(sx, 0); ctx.lineTo(sx, H); ctx.stroke();
    }
    for (let gy = Math.ceil(yMin); gy <= yMax; gy++) {
        const [, sy] = toScreen(0, gy);
        ctx.beginPath(); ctx.moveTo(0, sy); ctx.lineTo(W, sy); ctx.stroke();
    }

    // Axes
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 1;
    const [ax0, ay0] = toScreen(0, 0);
    ctx.beginPath(); ctx.moveTo(0, ay0); ctx.lineTo(W, ay0); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(ax0, 0); ctx.lineTo(ax0, H); ctx.stroke();

    // Axis labels
    ctx.fillStyle = '#444';
    ctx.font = '11px SF Mono, Consolas, monospace';
    ctx.textAlign = 'center';
    for (let gx = Math.ceil(xMin); gx <= xMax; gx++) {
        if (gx === 0) continue;
        const [sx] = toScreen(gx, 0);
        ctx.fillText(gx, sx, ay0 + 14);
    }
    ctx.textAlign = 'right';
    for (let gy = 1; gy <= yMax; gy += 2) {
        const [, sy] = toScreen(0, gy);
        ctx.fillText(gy, ax0 - 8, sy + 4);
    }

    // Parabola
    ctx.strokeStyle = '#5e9cff';
    ctx.lineWidth = 2;
    ctx.beginPath();
    for (let px = 0; px <= W; px++) {
        const wx = xMin + (px / W) * (xMax - xMin);
        const wy = f(wx);
        const [sx, sy] = toScreen(wx, wy);
        if (px === 0) ctx.moveTo(sx, sy);
        else ctx.lineTo(sx, sy);
    }
    ctx.stroke();

    // Tangent line
    const yVal = f(xVal);
    const slope = df(xVal);
    const tX0 = xMin;
    const tX1 = xMax;
    const tY0 = slope * (tX0 - xVal) + yVal;
    const tY1 = slope * (tX1 - xVal) + yVal;
    ctx.strokeStyle = 'rgba(240, 192, 64, 0.4)';
    ctx.lineWidth = 1.5;
    ctx.setLineDash([6, 4]);
    ctx.beginPath();
    const [tx0, ty0] = toScreen(tX0, tY0);
    const [tx1, ty1] = toScreen(tX1, tY1);
    ctx.moveTo(tx0, ty0);
    ctx.lineTo(tx1, ty1);
    ctx.stroke();
    ctx.setLineDash([]);

    // Vertical dashed line from (x, 0) to (x, f(x))
    const [bx, by] = toScreen(xVal, 0);
    const [sx, sy] = toScreen(xVal, yVal);
    ctx.setLineDash([4, 4]);
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.35)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(bx, by);
    ctx.lineTo(sx, sy);
    ctx.stroke();
    ctx.setLineDash([]);

    // Gradient arrow â€” on the x axis (domain), length = f'(x)
    const gradLen = slope;
    const arrowEndX = xVal + gradLen;
    const [asx] = toScreen(xVal, 0);
    const [aex] = toScreen(arrowEndX, 0);

    if (Math.abs(gradLen) > 0.01) {
        ctx.strokeStyle = '#f0c040';
        ctx.fillStyle = '#f0c040';
        ctx.lineWidth = 2.5;
        ctx.beginPath();
        ctx.moveTo(asx, by);
        ctx.lineTo(aex, by);
        ctx.stroke();

        // Arrowhead
        const headLen = 8;
        const dir = gradLen > 0 ? 1 : -1;
        ctx.beginPath();
        ctx.moveTo(aex, by);
        ctx.lineTo(aex - dir * headLen, by - 5);
        ctx.lineTo(aex - dir * headLen, by + 5);
        ctx.closePath();
        ctx.fill();
    }

    // Point on x axis (domain)
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(bx, by, 5, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#5e9cff';
    ctx.beginPath();
    ctx.arc(bx, by, 3, 0, Math.PI * 2);
    ctx.fill();

    // Point on curve
    const [px, py] = toScreen(xVal, yVal);
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(px, py, 6, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#5e9cff';
    ctx.beginPath();
    ctx.arc(px, py, 4, 0, Math.PI * 2);
    ctx.fill();

    // Update values
    document.getElementById('v-x').textContent = xVal.toFixed(2);
    document.getElementById('v-fx').textContent = yVal.toFixed(2);
    document.getElementById('v-dfx').textContent = slope.toFixed(2);
}

const slider = document.getElementById('slider');
slider.addEventListener('input', () => draw(parseFloat(slider.value)));

function onResize() {
    resize();
    draw(parseFloat(slider.value));
}
window.addEventListener('resize', onResize);
onResize();
</script>

</body>
</html>
